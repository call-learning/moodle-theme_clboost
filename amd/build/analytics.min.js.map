{"version":3,"file":"analytics.min.js","sources":["../src/analytics.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This is the main analytics code that will trigger google analytics when\n * the right event is triggered (policy accepted)\n *\n * @module   theme_clboost\n * @copyright 2021 - CALL Learning - Laurent David <laurent@call-learning.fr>\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport Templates from 'core/templates';\nimport log from 'core/log';\n/**\n * Initialize the analytics code\n * @param {String} gatriggerid\n * @param {String} gacode\n */\nexport const init = (gatriggerid, gacode) => {\n    const checkGAPolicyAccepted = (event) => {\n        const policies = event.detail;\n        if (policies) {\n            const found = policies.find(\n                (policy) => {\n                    return policy.policyversionid === gatriggerid;\n                }\n            );\n            if (found && found.accepted) {\n                Templates.render('theme_clboost/gtag', {gtagtrackingid: gacode}).then((html, js) => {\n                    const ga = document.createElement('div');\n                    document.body.appendChild(ga);\n                    Templates.replaceNodeContents(ga, html, js);\n                    return true;\n                }).catch((error) => {\n                    log.error(error);\n                });\n            }\n        }\n    };\n    document.addEventListener('grpd_policies_accepted', checkGAPolicyAccepted);\n    document.addEventListener('grpd_policies_current_status', checkGAPolicyAccepted);\n};"],"names":["gatriggerid","gacode","checkGAPolicyAccepted","event","policies","detail","found","find","policy","policyversionid","accepted","render","gtagtrackingid","then","html","js","ga","document","createElement","body","appendChild","replaceNodeContents","catch","error","addEventListener"],"mappings":";;;;;;;;gLA8BoB,CAACA,YAAaC,gBACxBC,sBAAyBC,cACrBC,SAAWD,MAAME,UACnBD,SAAU,OACJE,MAAQF,SAASG,MAClBC,QACUA,OAAOC,kBAAoBT,cAGtCM,OAASA,MAAMI,6BACLC,OAAO,qBAAsB,CAACC,eAAgBX,SAASY,MAAK,CAACC,KAAMC,YACnEC,GAAKC,SAASC,cAAc,cAClCD,SAASE,KAAKC,YAAYJ,uBAChBK,oBAAoBL,GAAIF,KAAMC,KACjC,KACRO,OAAOC,qBACFA,MAAMA,YAK1BN,SAASO,iBAAiB,yBAA0BtB,uBACpDe,SAASO,iBAAiB,+BAAgCtB"}